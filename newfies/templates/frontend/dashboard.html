{% extends "frontend/master.html" %}
{% load dialer_cdr_extras icons i18n %}

{% block title %}
{% trans 'Dashboard' %}
{% endblock %}

{% block extra_files %}
{% include "frontend/visualize_header.html" %}
{% endblock %}

{% block content %}

<form method="POST" action="." enctype="multipart/form-data">{% csrf_token %}
<p>{{ form.campaign.label }} {{ form.campaign }} {{ form.search_type }}
<input type="submit" name="submit" value="Submit">
</p>
<P>
    {% for j in total_data %}
        {{ j }}<br/>
    {% endfor %}
</P>
</form>
    
<table align="center" id="rounded-corner">
        <thead>
        <tr>
            <th class="rounded-company">Running Campaign</th>
            <th class="rounded-q1">Total Phonebook Contacts</th>
            <th class="rounded-q2">Total Campaign Contacts</th>
            <th class="rounded-q4">Contacted Today</th>
        </tr>
        </thead>
        <tr>
            <td class="rounded-foot-left">{{ running_campaign_count }}</td>
            <td>{{ total_of_phonebook_contacts }}</td>
            <td>{{ campaign_phonebbok_active_contact_count }}</td>
            <td class="rounded-foot-right">{{ reached_contact }}</td>
        </tr>

</table>

<br/><br/>
{{ start_date|date:"Y/m/d" }}
{{ end_date|date:"Y/m/d" }}

<script type="text/javascript">
var jsonData = [
{% for td in total_data %}
    {date:'{{ td.date }}', year:{{ td.year }},day:{{ td.day }}, month:{{ td.month }}, calls:{{ td.count }}, duration:'{{td.duration__sum|conv_min}}', act:'{{td.duration__avg|conv_min}}'},
{% endfor %}
];
var callData = [
{% for td in total_data %}
    [{{td.count}} , {{td.starting_date__count}}],
{% endfor %}
];
var durationData = [
{% for td in total_data %}
    [{{td.count}} , {{td.duration__sum}}],
{% endfor %}
];
var summaryData = [
{% for td in total_data %}
    [{{td.count}} , {{td.starting_date__count}}],
{% endfor %}
];
</script>

<script type="text/javascript">
Event.observe(document, 'dom:loaded', function() {

    prettyPrint();

    HumbleFinance.trackFormatter = function (obj) {
        var x = Math.floor(obj.x);
        var data = jsonData[x];
        var text = data.date + " {% trans "Calls :"  %} " + data.calls + " {% trans "Duration :"  %} " + data.duration + " {% trans "ACT :"  %} " + data.act;
        return text;
    };

    HumbleFinance.yTickFormatter = function (n) {

        if (n == this.axes.y.max) {
            return false;
        }
        return n;
    };

    HumbleFinance.xTickFormatter = function (n) {
        if (n == 0) {
            return false;
        }
        x = Math.floor(n)
        var data = jsonData[x].day;
        return data;
    };

    HumbleFinance.init('finance', callData, durationData, summaryData);
});
</script>

<div id="finance">
	<div id="labels">
	    <div id="financeTitle">{% trans "Campaign v/s Call Report"  %}</div>
	    <div id="time">
	        <a onclick="HumbleFinance.zoom(7);">1 {% trans "week"  %}</a>
	        <a onclick="HumbleFinance.zoom(30);">1 {% trans "month"  %}</a>
	        <a onclick="HumbleFinance.zoom(90);">3 {% trans "months"  %}</a>
	        <a onclick="HumbleFinance.zoom(180);">6 {% trans "months"  %}</a>
	        <a onclick="HumbleFinance.zoom(365);">1 {% trans "year"  %}</a>
	    </div>

	    <div id="dateRange"></div>
	</div>
</div>

<script type="text/javascript">
$(function () {

    var data = [
    {% for td in total_data %}
        { label: '{{ td.date }}' , data: [[1, {{td.starting_date__count}}]]},
    {% endfor %}
    ];
    var options = {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    label: {
                        show: true,
                        radius: 3/4,
                        formatter: function(label, series){
                            return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">'+label+'<br/>'+Math.round(series.percent)+'%</div>';
                            }
                        },
                    background: { opacity: 0.5 },
                }
            },
            legend: {show: false}
    };

    var plot = $.plot($("#camp_pie"), data, options);
});
</script>
    <br/> <div id="camp_pie" style="width:300px;height:300px"></div>
{% endblock %}
