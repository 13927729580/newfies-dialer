{% load i18n admin_tools_dashboard_tags %}
{% load memcache_status_tags %}

<script type="text/javascript" src="{{ media_url }}/admin_tools/js/utils.js"></script>
<script src="{{STATIC_URL}}newfies/js/admin_dashboard_script.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
    // Load js files syncronously and conditionally

    var js_files = [
        {
            src : '{{ media_url }}/admin_tools/js/jquery/jquery.min.js',
            test: function() { return typeof(jQuery) == 'undefined'; }
        },
        {
            src : '{{ media_url }}/admin_tools/js/jquery/jquery-ui.min.js',
            test: function() { return typeof(jQuery.ui) == 'undefined'; }
        },
        {
            src : '{{ media_url }}/admin_tools/js/json.min.js',
            test: function() { return typeof(JSON.stringify) == 'undefined'; }
        },
        {
            src : '{{ media_url }}/admin_tools/js/jquery/jquery.cookie.min.js',
            test: function() { return typeof(jQuery.cookie) == 'undefined'; }
        },
        {
            src : '{{ media_url }}/admin_tools/js/jquery/jquery.dashboard.js',
            test: function() { return true; }
        },
        {
            src : '{{ media_url }}/admin_tools/js/dashboard.js',
            test: function() { return true; }
        }{% for js in dashboard.Media.js %},
        {
            src : '{{ media_url }}/{{ js }}',
            test: function() { return true; }
        }{% endfor %}
    ];

    loadScripts(js_files, function(){
        jQuery(function($) {
            init_dashboard(
                '{{ dashboard.get_id }}',
                {{ dashboard.columns }},
                {% autoescape off %}{{ dashboard_preferences }}{% endautoescape %},
                '{% url admin-tools-dashboard-set-preferences dashboard.get_id %}'
            );
        });
    });
</script>

{% if dashboard.title %}
<h1 class="dashboard-title">{{ dashboard.title }}</h1>
{% endif %}

<div id="dashboard-panel">
    <h3><a href="#">{% trans "Modules" %}</a></h3>
    {% if has_disabled_modules %}
    <ul>
        {% spaceless %}
        {% for module in dashboard.children %}
        {% if not module.enabled %}
        <li><a href="#" rel="module_{{ module.id }}" class="addlink add-dashboard-module">{{ module.title }}</a></li>
        {% endif %}
        {% endfor %}
        {% endspaceless %}
    </ul>
    {% endif %}
</div>
<div id="{{ dashboard.get_id }}" class="dashboard-container">
    {% for module in dashboard.children %}
        {% admin_tools_render_dashboard_module module %}
    {% endfor %}

{% ifequal request.path "/admin/" %}

{% get_cache_stats %}
{% if cache_stats and user.is_superuser %}
<div class="cache_stats">
{% for server in cache_stats %}
<div class="dashboard-module draggable collapsible deletable">
    <table>
    <caption>
        <h2><a href="#"  onclick="
            var elem = document.getElementById('cache{{ forloop.counter }}');
            if(elem.style.display == 'none'){
                elem.style.display = 'table-row-group';
            }else{
                elem.style.display = 'none';
            }
            return false;
        ">memcached: {{ server.0 }} - {% widthratio server.1.bytes server.1.limit_maxbytes 100 %}% load</a> 
       </h2>
    </caption>
    <thead>
    <tr><td colspan="2">
        <div class="cache_graph">
            <div class="cache_graph_value" style="width: {% widthratio server.1.bytes server.1.limit_maxbytes 100 %}%"></div>
        </div>
    </td></tr>
    </thead>
    <tbody id="cache{{ forloop.counter }}">
    <tr>
        <th>{% trans "Miss Ratio" %}</th>
        <td>
            {% widthratio server.1.get_misses server.1.cmd_get 100 %}%
            <div class="cache_graph inline">
                <div class="cache_graph_value" style="width: {% widthratio server.1.get_misses server.1.cmd_get 100 %}%"></div>
            </div>
        </td>
    </tr>
    <tr>
        <th>{% trans "Avg GET by item" %}</th>
        <td>{% widthratio server.1.cmd_get server.1.total_items 1 %}</td>
    </tr>
    <tr>
        <th>{% trans "Avg GET by seconds/minutes" %}</th>
        <td>{% widthratio server.1.cmd_get server.1.uptime 1 %}/{% widthratio server.1.cmd_get server.1.uptime 60 %}</td>
    </tr>
    {# ----- Detailed Statistics ----- #}
    <tr><th class="cache_title" colspan="2">{% trans "Detailed Statistics:" %}</th></tr>
    {% for k,v in server.1.items %}
    <tr><th>{{ k|prettyname }}</th><td>{{ v|prettyvalue:k }}</td></tr>
    {% endfor %}
    </tbody>
    </table>
</div>
{% endfor %}
</div>
{% endif %}

<!--Call info div-->
<div class="dashboard-module draggable collapsible deletable">
    <h2>{% trans "Call Info" %}</h2>
    <div class="dashboard-module-content">
    <script type="text/javascript" language="javascript">
        // default when dashboard loaded 1st time
        var report_type = 'last_seven_days';
        var call_type = '';
        // default when dashboard loaded 1st time
        call_report(report_type);                
        call_report_graph(call_type, report_type);
    </script>
    <ul>
        <li>
        {% trans "Today" %} <input type="radio" name="report_type" id="id_report_today" value="today" onclick="call_me('today');">
        {% trans "Last 7 days" %} <input type="radio" name="report_type" id="id_report_seven" checked="checked" onclick="call_me('seven_days');" value="seven_days" >
        </li>
        <li>{% trans "Call Type" %} :
            <select name="call_type_select" id="id_call_type_select" onchange="call_me(this);">
                <option value="ALL">{% trans "ALL CALLS" %}</option>
                <option value="ANSWER">{% trans "ANSWER" %}</option>
                <option value="NOANSWER">{% trans "NOANSWER" %}</option>
                <option value="BUSY">{% trans "BUSY" %}</option>
                <option value="CANCEL">{% trans "CANCEL" %}</option>
                <option value="CONGESTION">{% trans "CONGESTION" %}</option>
                <option value="CHANUNAVAIL">{% trans "CHANUNAVAIL" %}</option>
                <option value="DONTCALL">{% trans "DONTCALL" %}</option>
                <option value="TORTURE">{% trans "TORTURE" %}</option>
                <option value="INVALIDARGS">{% trans "INVALIDARGS" %}</option>
                <option value="NOROUTE">{% trans "NOROUTE" %}</option>
                <option value="FORBIDDEN">{% trans "FORBIDDEN" %}</option>
                <option value="DURATION">{% trans "DURATION" %}</option>
            </select></li>
    </ul>
    <div id="call_report"></div>


    <center>
        <div class="graph_header">{% trans "Report" %}</div>
        <div id="placeholder1" style="width:250px;height:150px"></div>
    </center>
    </div>
</div>

<!--Campaign info div-->
<div class="dashboard-module draggable collapsible deletable">
    <h2>{% trans "Campaign Info" %}</h2>
    <script type="text/javascript" language="javascript">
        // default when dashboard loaded 1st time
        var report_type = 'last_seven_days'
        campaign_report(report_type);
        campaign_report_graph(report_type);
    </script>
    <div class="dashboard-module-content">
    <ul>
        <li>
            {% trans "Today" %} <input type="radio" onclick="camp_click_me('today');" name="camp_report_type" id="id_camp_report_today" value="today" >
            {% trans "Last 7 days" %} <input type="radio" onclick="camp_click_me('last_seven_days');" name="camp_report_type" id="id_camp_report_seven" checked="checked" value="seven_days" >
        </li>
    </ul>
    <div id="campaign_report"></div>
    <center>
        <div class="graph_header">{% trans "Report" %}</div>
        <div id="placeholder2" style="width:250px;height:150px"></div>
    </center>
    </div>
</div>

<!--User info Div -->
<div class="dashboard-module draggable collapsible deletable">
    <h2>{% trans "User Info" %}</h2>
    <div class="dashboard-module-content">
        <ul>
            <li>
                {% trans "Today" %} <input type="radio" onclick="user_click_me('today');" name="user_report_type" id="id_user_report_today" value="today" >
                {% trans "Last 7 days" %} <input type="radio" onclick="user_click_me('last_seven_days');" name="user_report_type" id="id_user_report_seven" checked="checked" value="seven_days" >
            </li>
        </ul>
        <script type="text/javascript" language="javascript">
            // default when dashboard loaded 1st time
            var report_type = 'last_seven_days'
            user_report(report_type);
            user_report_graph(report_type);
        </script>
        <div id="user_report"></div>

        <center>
            <div class="graph_header">{% trans "Report" %}</div>
            <div id="placeholder3" style="width:250px;height:150px"></div>
        </center>
    </div>
</div>
{% endifequal %}

